name: Fetch Manuscript Contents

on:
  pull_request:

jobs:
  fetch-manuscripts:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # Step 1: Fetch all .manuscript filenames
      - name: Fetch manuscript filenames
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh api \
            repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files \
            --jq '.[] 
              | select(.filename | endswith(".manuscript")) 
              | .filename' \
            > manuscript.txt

      - name: Show manuscript filenames
        run: |
          echo "Manuscript files found:"
          cat manuscript.txt || echo "No manuscripts found."

      # Step 2: Fetch content and print each manuscript
      - name: Print manuscript contents
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          while read file; do
            echo "=== Content of $file ==="
      
             # Get raw_url for the file in the PR
            raw_url=$(gh api \
              repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files \
              --jq '.[] | select(.filename=="'"$file"'") | .raw_url' | tr -d '"')
            
            # Fetch and print content
             curl -H "Authorization: token $GH_TOKEN" -s "$raw_url"
