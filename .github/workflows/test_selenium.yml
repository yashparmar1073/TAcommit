name: Fetch PR Files

on:
  pull_request:

jobs:
  list-pr-files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Fetch all files from the PR
        env:
          GH_TOKEN: ${{ github.token }}   # Required for gh CLI
        run: |
          gh api \
            repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files \
            --jq '.[].filename' \
            > manuscript.txt

      - name: Print all fetched filenames
        run: |
          echo "Files changed in PR:"
          cat manuscript.txt

      # - name: Fetch added .manuscript files
      #   env:
      #     GH_TOKEN: ${{ github.token }}
      #   run: |
      #     gh api \
      #     repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files \
      #     --jq '.[] 
      #       | select(.status == "added" 
      #                and (.filename | type == "string" and endswith(".manuscript"))) 
      #       | .filename' \
      #       > manuscripts.txt


      # - name: Show manuscript file names
      #   run: |
      #     echo "Found manuscript files:"
      #     cat manuscripts.txt

      # - name: Fetch manuscript content
      #   env:
      #     GH_TOKEN: ${{ github.token }}
      #   run: |
      #     while read file; do
      #       echo "=== $file ==="
      #       gh api \
      #         repos/${{ github.repository }}/contents/$file \
      #         --field ref=refs/pull/${{ github.event.pull_request.number }}/head \
      #         --jq '.content' \
      #       | base64 --decode
      #       echo
      #     done < manuscripts.txt
